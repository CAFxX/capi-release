#!/usr/bin/env bash

set -ex

function setup_blobstore_directories {
  local run_dir=/var/vcap/sys/run/blobstore
  local log_dir=/var/vcap/sys/log/blobstore
  local store_dir=/var/vcap/store/shared
  local data_dir=/var/vcap/data/blobstore
  local store_tmp_dir=$store_dir/tmp/uploads
  local data_tmp_dir=$data_dir/tmp/uploads
  local client_body_temp_dir=$store_dir/tmp/client_body_temp
  local nginx_webdav_dir=/var/vcap/packages/nginx_webdav

  mkdir -p \
    $run_dir \
    $log_dir \
    $store_dir \
    $store_tmp_dir \
    $data_dir \
    $data_tmp_dir \
    $client_body_temp_dir
    
  chown -R vcap:vcap \
    $run_dir \
    $log_dir \
    $store_dir \
    $store_tmp_dir \
    $data_dir \
    $data_tmp_dir \
    $client_body_temp_dir \
    $nginx_webdav_dir \
    "${nginx_webdav_dir}/.."
}

setup_blobstore_directories
